- task: AzureCLI@2
  inputs:
    azureSubscription: 'my-azure-connection'
    scriptType: 'bash'
    scriptLocation: 'inlineScript'
    inlineScript: |
      echo "üì• Getting AKS credentials..."
      az aks get-credentials --resource-group $(RESOURCE_GROUP) --name $(AKS_CLUSTER) --overwrite-existing

      echo "üöÄ Deploying HTML App to AKS..."
      kubectl apply -f htmlapp-deployment.yaml
      kubectl apply -f htmlapp-service.yaml

      echo "üêç Deploying Python App..."
      kubectl apply -f pythonapp/pythonapp-deployment.yaml
      kubectl apply -f pythonapp/pythonapp-service.yaml

      echo "üß© Deploying Nginx Proxy..."
      kubectl apply -f nginxproxy/nginxproxy-deployment.yaml
      kubectl apply -f nginxproxy/nginxproxy-service.yaml

      echo "‚ù§Ô∏è Deploying Healthcheck App..."
      kubectl apply -f healthcheck/healthcheck-deployment.yaml
      kubectl apply -f healthcheck/healthcheck-service.yaml
